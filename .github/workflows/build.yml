
name: Build

on: [push, pull_request]

jobs:
  linux-core:
    runs-on: ubuntu-16.04
    name: linux:${{ matrix.image }}-compiler:${{ matrix.compiler }}-llvm:${{ matrix.llvm }}-${{ matrix.build }}
    container:
      image: aswf/ci-vfxall:${{ matrix.image }}
    env:
      CXX: ${{ matrix.compiler }}
    strategy:
      matrix:
        image: ['2019', '2020']
        compiler: ['g++', 'clang++']
        build: ['Release', 'Debug']
        llvm: ['6.0.0', '7.0.0', '8.0.0', '9.0.0']
    steps:
      - uses: actions/checkout@v1
      - name: install_llvm
        run: ./ci/install_llvm.sh ${{ matrix.llvm }} /github/home/llvm-${{ matrix.llvm }}
      - name: build
        run: |
          ./ci/build.sh \
            -DCMAKE_BUILD_TYPE=${{ matrix.build }} \
            -DLLVM_DIR=/github/home/llvm-${{ matrix.llvm }}/lib/cmake/llvm \
            -DOPENVDB_CXX_STRICT=ON
      - name: test
        run: cd build && ctest -V
